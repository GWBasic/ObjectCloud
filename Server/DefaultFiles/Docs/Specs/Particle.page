{"Title":"Particle draft 2","Contents":"Particle is a system for collaborative\nmessaging and notification of changes to objects.  A subset of the\nparticle system includes collaborative, actively synchronized\ndocuments.\n\n\u003Cp style=\"margin-bottom: 0in;\">The Particle System is designed to\naddress the following technical needs:\u003C/p>\n\u003Cul>\u003Cli>\u003Cp style=\"margin-bottom: 0in;\">\u003Cb>Merging of chat and email V2\u003C/b>:\n\t The particle system is designed to allow email documents and chat\n\tto flow seamlessly into each other.  Instead of replying to an\n\temail, replies are typed in-line and the original author is notified\n\tthat the document is updated.\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp style=\"margin-bottom: 0in;\">\u003Cb>Spam Control:\u003C/b>\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp style=\"margin-bottom: 0in;\">\u003Cb>Security\u003C/b>:  The \u201Cspoofing\u201D\n\tproblem common to email is designed out of the protocol.\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp style=\"margin-bottom: 0in;\">\u003Cb>Barrier to entry\u003C/b>:  Servers\n\tcan optionally choose to require that other servers have a signed\n\tSSL certificate for their domain.  This creates a minor economic\n\tbarrier to spam, and increases a message's origin's traceability.\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp style=\"margin-bottom: 0in;\">\u003Cb>Standard way for clients to\n\tblock senders and domains\u003C/b>\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp style=\"margin-bottom: 0in;\">\u003Cb>Ease of federation:\u003C/b>\u003Cspan style=\"font-weight: normal;\">\n\t Particle uses RESTful APIs, which are easier to work with and\n\talmost universally supported in all programming languages\u003C/span>\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp style=\"margin-bottom: 0in;\">\u003Cb>Federation out-of-the-box\u003C/b>\u003Cspan style=\"font-weight: normal;\">:\n\t A sample federated server / client will be provided that works.\u003C/span>\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp style=\"margin-bottom: 0in;\">\u003Cb>OpenID integration\u003C/b>\u003Cspan style=\"font-weight: normal;\">:\n\t Particle is designed to work with OpenID accounts.  A particle user\n\tis an OpenID user.\u003C/span>\u003C/p>\n\u003C/li>\u003C/ul>\n\n\u003Ch1 class=\"western\" style=\"font-weight: normal;\">Overview of the\nnotification protocol\u003C/h1>\n\n\u003Cp style=\"margin-bottom: 0in; font-weight: normal;\">(Note:  The\nnotification protocol does not send changes to collaborative\ndocuments.  These are handled later.)\u003C/p>\n\n\u003Cp style=\"margin-bottom: 0in; font-weight: normal;\">In all cases, a\nsender or a client discover the particle endpoints in a manner\nsimilar to OpenID.  The OpenID uri will contain a link tag.\u003C/p>\n\n\u003Cp style=\"margin-bottom: 0in; font-weight: normal;\">The protocol has\ntwo stages between a sender and recipient:\u003C/p>\n\u003Cul>\u003Cli>\u003Cp style=\"margin-bottom: 0in; font-weight: normal;\">Establishing\n\ttrust between a sender and a recipient\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp style=\"margin-bottom: 0in; font-weight: normal;\">Sending\n\tnotifications from a sender to a recipient\u003C/p>\n\u003C/li>\u003C/ul>\n\n\u003Cp style=\"margin-bottom: 0in; font-weight: normal;\">The protocol also\nhas the following stages between a client and the server:\u003C/p>\n\u003Cul>\u003Cli>\u003Cp style=\"margin-bottom: 0in; font-weight: normal;\">Establishing\n\ta session between a client and a server\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp style=\"margin-bottom: 0in; font-weight: normal;\">Receiving new\n\tnotifications since a particular date\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp style=\"margin-bottom: 0in; font-weight: normal;\">Update the\n\tstate of a notification to the following:\u003C/p>\n\t\u003Cul>\u003Cli>\u003Cp style=\"margin-bottom: 0in; font-weight: normal;\">read\u003C/p>\n\t\t\u003C/li>\u003Cli>\u003Cp style=\"margin-bottom: 0in; font-weight: normal;\">unread\u003C/p>\n\t\u003C/li>\u003C/ul>\n\t\u003C/li>\u003Cli>\u003Cp style=\"margin-bottom: 0in; font-weight: normal;\">Update an\n\tobject's state to:\u003C/p>\n\t\u003Cul>\u003Cli>\u003Cp style=\"margin-bottom: 0in; font-weight: normal;\">Ignore  (All\n\t\tnew notifications to a given object / url are hidden)\u003C/p>\n\t\t\u003C/li>\u003Cli>\u003Cp style=\"margin-bottom: 0in; font-weight: normal;\">Unignore \n\t\t(All new notifications to a given object / url are displayed.)\u003C/p>\n\t\t\u003C/li>\u003Cli>\u003Cp style=\"margin-bottom: 0in; font-weight: normal;\">Delete (All\n\t\tnotifications to a given object / url are ignored and currently\n\t\tsaved ones are deleted.  The sender is asked to discontinue sending\n\t\tnotifications.)\u003C/p>\n\t\t\u003C/li>\u003Cli>\u003Cp style=\"margin-bottom: 0in; font-weight: normal;\">SilentDelete\n\t\t(Same as delete except that the sender isn't asked to discontinue\n\t\tsending notifications.)\u003C/p>\n\t\u003C/li>\u003C/ul>\n\t\u003C/li>\u003Cli>\u003Cp style=\"margin-bottom: 0in; font-weight: normal;\">Block sender\n\tor domain\u003C/p>\n\u003C/li>\u003C/ul>\n\n\u003Cp style=\"margin-bottom: 0in; font-weight: normal;\">Some\nimplementations may optionally allow a change from SilentDelete to\nUnignore.\u003C/p>\n\u003Ch1 class=\"western\" style=\"font-weight: normal;\">Discovering the\nParticle Endpoint:\u003C/h1>\n\u003Cp style=\"margin-bottom: 0in; font-weight: normal;\">Discovering the\nparticle endpoint is performed in a manner similar to OpenID:\u003C/p>\n\u003Col>\u003Cli>\u003Cp style=\"margin-bottom: 0in; font-weight: normal;\">Download the\n\tHTML document at the recipient's openID uri\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp style=\"margin-bottom: 0in; font-weight: normal;\">Scan the\n\t&lt;title&gt; section for &lt;link&gt; tags\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp style=\"margin-bottom: 0in; font-weight: normal;\">All link tags\n\twhere the rel=\u201Dparticle.\u201D are Particle endpoints.\u003C/p>\n\u003C/li>\u003C/ol>\n\n\u003Cp style=\"margin-bottom: 0in; font-weight: normal;\">Particle endpoints\ncan be cached as a means of conserving resources.  It is recommended\nthat cached endpoints expire after a reasonable time, such as after a\n4 or 24-hour window.\u003C/p>\n\n\u003Cp style=\"margin-bottom: 0in; font-weight: normal;\">Example:\u003C/p>\n\n\u003Cp style=\"margin-bottom: 0in;\">\u003Cspan style=\"font-weight: normal;\">for\nthe OpenID \u003Ca href=\"http://objectcloud.com/Users/GWBasic.user\">http://objectcloud.com/Users/GWBasic.user\u003C/a>:\u003C/span>\u003C/p>\n\n\u003Cp style=\"margin-bottom: 0in;\">\u003Cspan style=\"font-weight: normal;\">Downloading\n\u003Ca href=\"http://objectcloud.com/Users/GWBasic.user\">http://objectcloud.com/Users/GWBasic.user\u003C/a>\nyields:\u003C/span>\u003C/p>\n\n\u003Cpre style=\"margin-bottom: 0in; font-weight: normal; margin-left: 40px;\">&lt;html&gt;&lt;head&gt;\u003C/pre>\n\u003Cpre style=\"margin-bottom: 0in; font-weight: normal; margin-left: 40px;\">\u2026\u003C/pre>\n\u003Cpre style=\"margin-bottom: 0in; margin-left: 40px;\">   \u003Cspan style=\"font-weight: normal;\">&lt;link\nrel=\u201Dparticle.establishTrust\u201D\nhref=\u201D\u003Ca href=\"http://objectcloud/Users/GWBasic/part.icle?Method=establsihTrust\">https://objectcloud/Users/GWBasic/part.icle?Method=establsihTrust\u003C/a>\u201D\n/&gt;\u003C/span>\u003C/pre>\n\u003Cpre style=\"margin-bottom: 0in; margin-left: 40px;\">   \u003Cspan style=\"font-weight: normal;\">&lt;link\nrel=\u201Dparticle.respondTrust\u201D\nhref=\u201D\u003Ca href=\"http://objectcloud/Users/GWBasic/part.icle?Method=establsihTrust\">https://objectcloud/Users/GWBasic/part.icle?Method=respondTrust\u003C/a>\u201D\n/&gt;\u003C/span>\u003C/pre>\n\u003Cpre style=\"margin-bottom: 0in; margin-left: 40px;\">   \u003Cspan style=\"font-weight: normal;\">&lt;link\nrel=\u201Dparticle.receiveNotification\u201D\nhref=\u201D\u003Ca href=\"http://objectcloud/Users/GWBasic/part.icle?Method=establsihTrust\">https://objectcloud/Users/GWBasic/part.icle?Method=receiveNotification\u003C/a>\u201D\n/&gt;\u003C/span>\u003C/pre>\n\u003Cpre style=\"margin-bottom: 0in; margin-left: 40px;\">   \u003Cspan style=\"font-weight: normal;\">&lt;link\nrel=\u201Dparticle.establishSession\u201D\nhref=\u201D\u003Ca href=\"http://objectcloud/Users/GWBasic/part.icle?Method=establsihTrust\">https://objectcloud/Users/GWBasic/part.icle?Method=establishSession\u003C/a>\u201D\n/&gt;\u003C/span>\u003C/pre>\n\u003Cpre style=\"margin-bottom: 0in; margin-left: 40px;\">   \u003Cspan style=\"font-weight: normal;\">&lt;link\nrel=\u201Dparticle.getNotifications\u201D\nhref=\u201D\u003Ca href=\"http://objectcloud/Users/GWBasic/part.icle?Method=establsihTrust\">https://objectcloud/Users/GWBasic/part.icle?Method=getNotifications\u003C/a>\u201D\n/&gt;\u003C/span>\u003C/pre>\n\u003Cpre style=\"margin-bottom: 0in; margin-left: 40px;\">   \u003Cspan style=\"font-weight: normal;\">&lt;link\nrel=\u201Dparticle.updateNotificationState\u201D\nhref=\u201D\u003Ca href=\"http://objectcloud/Users/GWBasic/part.icle?Method=establsihTrust\">https://objectcloud/Users/GWBasic/part.icle?Method=updateNotificationState\u003C/a>\u201D\n/&gt;\u003C/span>\u003C/pre>\n\u003Cpre style=\"margin-bottom: 0in; margin-left: 40px;\">   \u003Cspan style=\"font-weight: normal;\">&lt;link\nrel=\u201Dparticle.updateObjectState\u201D\nhref=\u201D\u003Ca href=\"http://objectcloud/Users/GWBasic/part.icle?Method=establsihTrust\">https://objectcloud/Users/GWBasic/part.icle?Method=updateObjectState\u003C/a>\u201D\n/&gt;\u003C/span>\u003C/pre>\n\u003Cpre style=\"margin-bottom: 0in; margin-left: 40px;\">   \u003Cspan style=\"font-weight: normal;\">&lt;link\nrel=\u201Dparticle.block\u201D\nhref=\u201D\u003Ca href=\"http://objectcloud/Users/GWBasic/part.icle?Method=establsihTrust\">https://objectcloud/Users/GWBasic/part.icle?Method=block\u003C/a>\u201D\n/&gt;\u003C/span>\u003C/pre>\n\u003Cpre style=\"margin-bottom: 0in; margin-left: 40px;\">   \u003Cspan style=\"font-weight: normal;\">&lt;link\nrel=\u201Dparticle.unBlock\u201D\nhref=\u201D\u003Ca href=\"http://objectcloud/Users/GWBasic/part.icle?Method=establsihTrust\">https://objectcloud/Users/GWBasic/part.icle?Method=unBlock\u003C/a>\u201D\n/&gt;\u003C/span>\u003C/pre>\n\u003Cpre style=\"margin-bottom: 0in; margin-left: 40px;\">   \u003Cspan style=\"font-weight: normal;\">&lt;link\nrel=\u201Dparticle.sendNotification\u201D\nhref=\u201D\u003Ca href=\"http://objectcloud/Users/GWBasic/part.icle?Method=establsihTrust\">https://objectcloud/Users/GWBasic/part.icle?Method=sendNotification\u003C/a>\u201D\n/&gt;\u003C/span>\u003C/pre>\n\u003Cpre style=\"margin-bottom: 0in; font-weight: normal; margin-left: 40px;\">   \u2026\u003C/pre>\n\n\u003Cp style=\"margin-bottom: 0in; font-weight: normal;\">All endpoints\nutilize urlencoded POST requests.  Argument names are case-sensitive.\u003C/p>\n\u003Ch1 class=\"western\" style=\"font-weight: normal;\">Establishing Trust\u003C/h1>\n\u003Cp style=\"font-weight: normal;\">In order to prevent the spoofing\nproblem that is common in email, trust must be established between a\nsender and a recipient.  The trust relationship establishes the\nfollowing facts:\u003C/p>\n\u003Cul>\u003Cli>\u003Cp style=\"font-weight: normal;\">That the sender is who it says it\n\tis\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp style=\"font-weight: normal;\">(Optional) That the sender has a\n\tregistered and signed domain\u003C/p>\n\u003C/li>\u003C/ul>\n\u003Cp style=\"font-weight: normal;\">Production systems are strongly\nencouraged to enable SSL and only accept notifications from\nSSL-signed domains.  This creates a financial barrier to SPAMmers\nthat is nominal for legitimate entities.\u003C/p>\n\u003Col>\u003Cli>\u003Cp style=\"font-weight: normal;\">The sender sends a POST request\n\tto the recipient's particle.establishTrust endpoint.  It has two\n\targuments:\u003C/p>\n\u003C/li>\u003C/ol>\n\u003Col>\u003Cli>\u003Cp>\u003Cb>sender\u003C/b>\u003Cspan style=\"font-weight: normal;\">:  The\n\tsender's OpenID\u003C/span>\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp>\u003Cb>token\u003C/b>\u003Cspan style=\"font-weight: normal;\">:  A token to\n\tsend back to the sender in order to establish trust.  This is a\n\tstring of any length.\u003C/span>\u003C/p>\n\u003C/li>\u003C/ol>\n\u003Col start=\"2\">\u003Cli>\u003Cp style=\"font-weight: normal;\">While the sender's request is\n\topen, the recipient sends a POST request to the sender's\n\tparticle.respondTrust endpoint.  It has two arguments:\u003C/p>\n\u003C/li>\u003C/ol>\n\u003Col>\u003Cli>\u003Cp>\u003Cb>token\u003C/b>\u003Cspan style=\"font-weight: normal;\">:  The token\n\tsent from the originating particle.establishTrust call\u003C/span>\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp>\u003Cb>senderToken\u003C/b>\u003Cspan style=\"font-weight: normal;\">:  A\n\tstring generated by the recipient that it uses to identify the\n\tsender.  This can contain any character, and can be a maximum of 200\n\tcharacters.\u003C/span>\u003C/p>\n\u003C/li>\u003C/ol>\n\u003Col start=\"3\">\u003Cli>\u003Cp style=\"font-weight: normal;\">The sender responds to the\n\tparticle.respondTrust request with either a 202 (accepted) status\n\tcode if the senderToken was established correctly, or a 4xx error\n\tcode to indicate an error.\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp style=\"font-weight: normal;\">The recipient responds to the\n\tparticle.establishTrust with either a 201 (Created) or a 4xx error\n\tcode to indicate an error.\u003C/p>\n\u003C/li>\u003C/ol>\n\u003Cp style=\"font-weight: normal;\">Notes:\u003C/p>\n\u003Cp style=\"font-weight: normal;\">The recipient and sender will store\nthe senderToken in their own internal databases.  When sending\nnotifications, the senderToken is sent as a means of identifying who\nthe sender is.  The recipient can require that the sender obtain a\nnew senderToken at any time.\u003C/p>\n\u003Cp style=\"font-weight: normal;\">The requests described are\nsynchronous, that is, the sender does not return from the\nparticle.establishTrust request until after the particle.respondTrust\nis complete.\u003C/p>\n\u003Cp style=\"font-weight: normal;\">The token and senderToken can contain\nany string value.  It is recommended that clients utilize algorithms\nthat ensure that these strings are sufficiently random and hard to\nguess.\u003C/p>\n\u003Cp style=\"font-weight: normal;\">The sender should delete token during\nthe call to particle.respondTrust to prevent security violations.\u003C/p>\n\u003Cp style=\"font-weight: normal;\">SenderTokens are one-way. \nSpecifically, if the token that Jack uses when sending notifications\nto Jill is different then what Jill uses to send notifications to\nJack.\u003C/p>\n\u003Ch1 class=\"western\" style=\"font-weight: normal;\">Receiving a\nNotification\u003C/h1>\u003Ch2>Downloading Existing Notifications\u003Cbr>\u003C/h2>\n\u003Cp style=\"font-weight: normal;\">When a server sends a notification to\nanother server, the sender uses particle.receiveNotification\nendpoint.  In order to identify itself, the sender uses the\nsenderToken that it obtained when it established trust.  The sender\nmust be prepared to re-establish trust at any time.\u003C/p>\n\u003Col>\u003Cli>\u003Cp class=\"numbering-1-western\" style=\"font-weight: normal;\">The\n\tsender sends a POST request to the particle.receiveNotification\n\tendpoint.  The following urlencoded arguments are present:\u003C/p>\n\t\u003Col>\u003Cli>\u003Cp class=\"numbering-1-western\">\u003Cb>senderToken\u003C/b>\u003Cspan style=\"font-weight: normal;\">:\n\t\t This is the senderToken established during the calls to\n\t\tparticle.establishTrust and particle.respondTrust.  It identifies\n\t\tthe sender and prohibits spoofing\u003C/span>\u003C/p>\n\t\t\u003C/li>\u003Cli>\u003Cp class=\"numbering-1-western\">\u003Cb>objectUrl\u003C/b>\u003Cspan style=\"font-weight: normal;\">:\n\t\t The URL to the document.  Displaying this URL in an iFrame should\n\t\talways work on simpler clients.  This value should never change,\n\t\tand is considered the object's unique ID.\u003C/span>\u003C/p>\n\t\t\u003C/li>\u003Cli>\u003Cp class=\"numbering-1-western\">\u003Cb>title\u003C/b>\u003Cspan style=\"font-weight: normal;\">:\n\t\t The title of the document.  This is always the newest version of\n\t\tthe target object's title, and can change between notifications.\u003C/span>\u003C/p>\n\t\t\u003C/li>\u003Cli>\u003Cp class=\"numbering-1-western\">\u003Cb>documentType\u003C/b>\u003Cspan style=\"font-weight: normal;\">:\n\t\t The document type.  Some particle clients might be able to provide\n\t\tenhanced capabilities for known document types.  For unknown\n\t\tdocument types, the url will be displayed in an iFrame.\u003C/span>\u003C/p>\n\t\t\u003C/li>\u003Cli>\u003Cp class=\"numbering-1-western\">\u003Cb>messageSummary\u003C/b>\u003Cspan style=\"font-weight: normal;\">:\n\t\t A summary of the notification that will be displayed to the\n\t\trecipient.  The recommended convention is to limit this to 80\n\t\tcharacters.  Examples include:\u003C/span>\u003C/p>\n\t\u003C/li>\u003C/ol>\n\u003C/li>\u003C/ol>\n\u003Cul>\u003Cul>\u003Cul>\u003Cli>\u003Cp class=\"numbering-1-western\" style=\"font-weight: normal;\">Sender\n\t\t\tshared a document with you\u003C/p>\n\t\t\t\u003C/li>\u003Cli>\u003Cp class=\"numbering-1-western\" style=\"font-weight: normal;\">Sender\n\t\t\tupdated the document\u003C/p>\n\t\t\t\u003C/li>\u003Cli>\u003Cp class=\"numbering-1-western\" style=\"font-weight: normal;\">Sender\n\t\t\tadded you to the conversation\u003C/p>\n\t\t\t\u003C/li>\u003Cli>\u003Cp class=\"numbering-1-western\" style=\"font-weight: normal;\">Sender\n\t\t\tsaid: \u201C...\u201D\u003C/p>\n\t\t\u003C/li>\u003C/ul>\u003C/ul>\u003C/ul>\n\u003Col>\u003Col>\u003Cli>\u003Cp class=\"numbering-1-western\">\u003Cb>changeData\u003C/b>\u003Cspan style=\"font-weight: normal;\">:\n\t\t Additional data that describes the change.  This is only utilized\n\t\tif the client recognizes the documentType.  The specific format of\n\t\tchangeData is defined by the documentType.  JSON is recommended,\n\t\talthough any string-based encoding will work.\u003C/span>\u003C/p>\n\t\u003C/li>\u003C/ol>\u003Cli>\u003Cp class=\"numbering-1-western\" style=\"font-weight: normal;\">If\n\tthe senderToken is unknown or trust needs to be re-established, then\n\trecipient responds with a 412 (precondition failed.) and the text\n\t\u201CsenderToken\u201D.  The sender should use the\n\tprovider.establishTrust endpoint to get a new senderToken, and then\n\tre-send the notification.\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp class=\"numbering-1-western\" style=\"font-weight: normal;\">If\n\tthe notification was sent successfully, then the recipient responds\n\twith a 202 (accepted).\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp class=\"numbering-1-western\" style=\"font-weight: normal;\">The\n\terror code 450 (Blocked) is used to indicate that the sender should\n\tstop sending new notifications for the objectUrl.  Recipients should\n\thave additional logic to handle cases where this error code is\n\tignored.  Recipients may choose not to send this and continue to\n\tignore notifications to deleted objects.\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp class=\"numbering-1-western\" style=\"font-weight: normal;\">Some\n\tdocumentTypes might have additional error codes that need to be\n\treturned to the object initiating the notification.  These are not\n\tpart of Particle's notification protocol.\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp class=\"numbering-1-western\" style=\"font-weight: normal;\">The\n\trecipient should block any notifications for objects that do not\n\tcome from the same server as the sender.  If this happens, then the\n\tserver will return a 406 (Not Acceptable.)  The server can also\n\toptionally return a note explaining the error; however, this is\n\toptional.\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp class=\"numbering-1-western\" style=\"font-weight: normal;\">The\n\trecipient will unblock any clients that have pending requests on\n\tparticle.getNotifications waiting for updated notifications.\u003C/p>\n\u003C/li>\u003C/ol>\n\u003Cp style=\"font-weight: normal;\">Notes:\u003C/p>\n\u003Cp style=\"font-weight: normal;\">For collaborative documents, the\nsender should be the document's owner.  The particle protocol does\nnot include explicit functionality to indicate which user made a\nparticular change to a document; thus the sender will always be the\ndocument's owner instead of who made the modification.\u003C/p>\n\u003Cp style=\"font-weight: normal;\">Object creation is implicit; that is,\na recipient becomes aware of an object as soon as it gets a\nnotification that has the object's objectUrl as an argument. \nRecipients should store the objectUrl of objects that are deleted,\nthis way they do not become aware of objects again if they continue\nto receive unwanted notifications.\u003C/p>\n\u003Cp style=\"font-weight: normal;\">Some databases work better when\n\u201Cstring\u201D columns are fixed length.  The recommended length for\nmessageSummary is 80 characters.  Senders need to take into\nconsideration that their messageSummary could be truncated if longer\nthen 80 characters.\u003C/p>\u003Ch2 style=\"font-weight: normal;\">Waiting for New Notifications with Comet\u003C/h2>\u003Cp>The particle system allows a client to know exactly when a notification arrives.&nbsp; This is accomplished with a layer 3 Queuing and Reliable Comet session.&nbsp; (The Comet Protocol is document at \u003Ca target=\"_blank\" title=\"\" href=\"/Docs/Specs/Comet%20Protocol.page\">/Docs/Specs/Comet Protocol.page)\u003C/a>\u003C/p>To wait for incoming notifications, establish a Queuing and Reliable Comet session at the particle.incomingNotificationEvent endpoint.&nbsp; The server will send each notification as it arrives.&nbsp; Notifications are sent as JSON objects using the same format as recieveNotification endpoint, except that all columns are always present.\u003Cbr>\u003Ch1 class=\"western\" style=\"font-weight: normal;\">Establishing a\nsession\u003C/h1>\n\u003Cp style=\"font-weight: normal;\">The particle.establishSession endpoint\nis used to allow a client program to establish a session to display\nnotifications.  This is primarily intended for use with mobile\ndevices and thick clients.  Web-based clients where the Particle\nendpoints reside on the same server as the HTML can use whatever\nsystem they desire for authentication.\u003C/p>\n\u003Cp style=\"font-weight: normal;\">Future modifications to the protocol\nmight replace this with a more secure means of establishing a\nsession.\u003C/p>\n\u003Col>\u003Cli>\u003Cp style=\"font-weight: normal;\">The client program or device\n\tstores the OpenID and password.\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp style=\"font-weight: normal;\">The client program makes a POST\n\trequest to particle.establishSession with the following urlencoded\n\targument:\u003C/p>\n\t\u003Col>\u003Cli>\u003Cp>\u003Cb>password\u003C/b>\u003Cspan style=\"font-weight: normal;\">:  The\n\t\tpassword\u003C/span>\u003C/p>\n\t\u003C/li>\u003C/ol>\n\t\u003C/li>\u003Cli>\u003Cp style=\"font-weight: normal;\">The http status code 202\n\t(accepted) is returned to indicate that the session was created\n\tsuccessfully.  Any 4xx response indicates some form of error.\u003C/p>\n\u003C/li>\u003C/ol>\n\u003Cp style=\"font-weight: normal;\">It is assumed that session will be\nmaintained through HTTP cookies.  Therefore, the client program or\ndevice should use an HTTP library that can persist session-level\ncookies.\u003C/p>\n\u003Ch1 class=\"western\" style=\"font-weight: normal;\">Getting Notifications\u003C/h1>\n\u003Cp style=\"font-weight: normal;\">The particle.getNotifications endpoint\nallows any client or device to get all notifications or a subset of\nrecent notifications.  Prior to using this endpoint, a session must\nbe established using particle.establishSession or another suitable\ntechnique.\u003C/p>\n\u003Cp style=\"font-weight: normal;\">All notifications have a notification\nID.  This is an unsigned integer.  The first notification has a low\nID, and each subsequent notification received has one value higher. \nNotification IDs should never be skipped and are immutable.  If a\nnotification is deleted from the database, its ID should never be\nre-used.  The lowest ID is implementation-specific.  Due to\ndeletions, clients should not expect the lowest notificationId to be\n0, 1 or some other constant.\u003C/p>\n\u003Cp style=\"font-weight: normal;\">There is no highest value of\nnotification ID.  Implementations should be designed such that this\nID can become very large.  64-bit unsigned integers are recommended\nas a minimum size.\u003C/p>\n\u003Col>\u003Cli>\u003Cp style=\"font-weight: normal;\">The client sends a GET request to\n\tthe particle.getNotifications endpoint with the following optional\n\turlencoded arguments:\u003C/p>\n\t\u003Col>\u003Cli>\u003Cp>\u003Cb>newestNotificationId\u003C/b>\u003Cspan style=\"font-weight: normal;\">:\n\t\t The highest notificationId allowed.\u003C/span>\u003C/p>\n\t\t\u003C/li>\u003Cli>\u003Cp>\u003Cb>oldestNotificationId\u003C/b>\u003Cspan style=\"font-weight: normal;\">:\n\t\t The lowest notificationId allowed.\u003C/span>\u003C/p>\n\t\t\u003C/li>\u003Cli>\u003Cp>\u003Cb>maxNotifications\u003C/b>\u003Cspan style=\"font-weight: normal;\">: \n\t\tThe maximum number of notifications that are to be returned.  Older\n\t\tnotifications are filtered out if needed.\u003C/span>\u003C/p>\n\t\t\u003C/li>\u003Cli>\u003Cp>\u003Cb>objectUrl\u003C/b>\u003Cspan style=\"font-weight: normal;\">:  If\n\t\tpresent, only notifications for the given objectUrl are returned.\u003C/span>\u003C/p>\n\t\t\u003C/li>\u003Cli>\u003Cp>\u003Cb>sender\u003C/b>\u003Cspan style=\"font-weight: normal;\">:  The\n\t\tsender's OpenId.  If present, only notifications from the OpenID of\n\t\tthe sender are returned.\u003C/span>\u003C/p>\n\t\t\u003C/li>\u003Cli>\u003Cp>\u003Cb>desiredValues\u003C/b>\u003Cspan style=\"font-weight: normal;\">: \n\t\tComma-separated list of values to return.  If missing, all values\n\t\tfor each notification are returned.  If an unknown value is\n\t\tspecified, it is ignored.\u003C/span>\u003C/p>\n\t\t\u003C/li>\u003C/ol>\n\t\u003C/li>\u003Cli>\u003Cp style=\"font-weight: normal;\">Notifications are returned in the\n\torder that starts with the newest notification first.\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp style=\"font-weight: normal;\">If all arguments are omitted,\n\tthen all notifications are returned without changeData.\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp style=\"font-weight: normal;\">The client is responsible for\n\thandling situations where an object has notifications outside of the\n\trange requested.\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp style=\"font-weight: normal;\">Upon success, a 200 (OK) status\n\tcode is returned.  The notifications returned are in JSON format.  A\n\tJSON array is used with the newest notification first.  The\n\tfollowing values, except for changeData, are returned, unless\n\tdesiredValues specifies a subset:\u003C/p>\n\u003C/li>\u003C/ol>\n\u003Col>\u003Col>\u003Cli>\u003Cp class=\"numbering-1-western\">\u003Cb>notificationId\u003C/b>\u003C/p>\n\t\t\u003C/li>\u003Cli>\u003Cp class=\"numbering-1-western\">\u003Cb>timeStamp\u003C/b>\u003Cspan style=\"font-weight: normal;\">:\n\t\t The exact date/time when the notification was sent.  Represented\n\t\tas the number of milliseconds since January 1st 1970 UTC.\u003C/span>\u003C/p>\n\t\t\u003C/li>\u003Cli>\u003Cp class=\"numbering-1-western\">\u003Cb>state\u003C/b>\u003Cspan style=\"font-weight: normal;\">:\n\t\t Either read or unread\u003C/span>\u003C/p>\n\t\t\u003C/li>\u003Cli>\u003Cp class=\"numbering-1-western\">\u003Cb>sender\u003C/b>\u003Cspan style=\"font-weight: normal;\">:\n\t\t The notification's sender's OpenId.  This value can be omitted if\n\t\tthe sender argument is sent.\u003C/span>\u003C/p>\n\t\t\u003C/li>\u003Cli>\u003Cp class=\"numbering-1-western\">\u003Cb>objectUrl\u003C/b>\u003Cspan style=\"font-weight: normal;\">:\n\t\t The URL to the document.  Displaying this URL in an iFrame should\n\t\talways work on simpler clients.\u003C/span>\u003C/p>\n\t\t\u003C/li>\u003Cli>\u003Cp class=\"numbering-1-western\">\u003Cb>title\u003C/b>\u003Cspan style=\"font-weight: normal;\">:\n\t\t The title of the document as of when the notification was sent.\u003C/span>\u003C/p>\n\t\t\u003C/li>\u003Cli>\u003Cp class=\"numbering-1-western\">\u003Cb>documentType\u003C/b>\u003Cspan style=\"font-weight: normal;\">:\n\t\t The document type.  Some particle clients might be able to provide\n\t\tenhanced capabilities for known document types.  For unknown\n\t\tdocument types, the url will be displayed in an iFrame.\u003C/span>\u003C/p>\n\t\t\u003C/li>\u003Cli>\u003Cp class=\"numbering-1-western\">\u003Cb>messageSummary\u003C/b>\u003Cspan style=\"font-weight: normal;\">:\n\t\t A summary of the notification that will be displayed in the GUI. \n\t\tExamples include:\u003C/span>\u003C/p>\n\t\u003C/li>\u003C/ol>\u003C/ol>\n\u003Cul>\u003Cul>\u003Cul>\u003Cli>\u003Cp class=\"numbering-1-western\" style=\"font-weight: normal;\">Sender\n\t\t\tshared a document with you\u003C/p>\n\t\t\t\u003C/li>\u003Cli>\u003Cp class=\"numbering-1-western\" style=\"font-weight: normal;\">Sender\n\t\t\tupdated the document\u003C/p>\n\t\t\t\u003C/li>\u003Cli>\u003Cp class=\"numbering-1-western\" style=\"font-weight: normal;\">Sender\n\t\t\tadded you to the conversation\u003C/p>\n\t\t\t\u003C/li>\u003Cli>\u003Cp class=\"numbering-1-western\" style=\"font-weight: normal;\">Sender\n\t\t\tsaid: \u201C...\u201D\u003C/p>\n\t\t\u003C/li>\u003C/ul>\u003C/ul>\u003C/ul>\n\u003Col>\u003Col>\u003Cli>\u003Cp class=\"numbering-1-western\">\u003Cb>changeData\u003C/b>\u003Cspan style=\"font-weight: normal;\">:\n\t\t Only returned if explicitly requested in the desiredData argument.\n\t\t This is because changeData can become burdensomely large.  If\n\t\tblock is set to true, changeData is always included if new\n\t\tnotifications arrive.\u003C/span>\u003C/p>\n\t\u003C/li>\u003C/ol>\u003Cli>\u003Cp class=\"numbering-1-western\" style=\"font-weight: normal;\">Upon\n\tfailure, the server should send a 400-class error.\u003C/p>\n\u003C/li>\u003C/ol>\n\u003Ch1 class=\"western\" style=\"font-weight: normal;\">Updating a\nNotification's State\u003C/h1>\n\u003Cp style=\"font-weight: normal;\">The particle.updateNotificationState\nis used to update a notification's state.\u003C/p>\n\u003Col>\u003Cli>\u003Cp style=\"font-weight: normal;\">The client sends a POST request\n\tto the particle.updateNotificationState endpoint with the following\n\turlencoded arguments:\u003C/p>\n\t\u003Col>\u003Cli>\u003Cp>\u003Cb>readNotificationIds\u003C/b>\u003Cspan style=\"font-weight: normal;\">:\n\t\t Comma-seperated list of notificationIds for notifications to be\n\t\tset to \u201Cread\u201D\u003C/span>\u003C/p>\n\t\t\u003C/li>\u003Cli>\u003Cp>\u003Cb>unreadNotificationIds\u003C/b>\u003Cspan style=\"font-weight: normal;\">:\n\t\t Comma-seperated list of notificationIds for notifications to be\n\t\tset to \u201Cread\u201D\u003C/span>\u003C/p>\n\t\u003C/li>\u003C/ol>\n\t\u003C/li>\u003Cli>\u003Cp style=\"font-weight: normal;\">The server returns with 202\n\t(accepted) or a 4xx if an error occurs.\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp style=\"font-weight: normal;\">All blocked requests for updates\n\tto notifications are completed.\u003C/p>\n\u003C/li>\u003C/ol>\n\u003Ch1 class=\"western\" style=\"font-weight: normal;\">Updating an Object's\nState\u003C/h1>\n\u003Cp style=\"font-weight: normal;\">The particle.updateObjectState is used\nto update a object's state.  The following states are supported:\u003C/p>\n\u003Cul>\u003Cli>\u003Cp style=\"margin-bottom: 0in; font-weight: normal;\">Ignore  (All\n\tnew notifications to a given object / url are hidden)\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp style=\"margin-bottom: 0in; font-weight: normal;\">Unignore \n\t(All new notifications to a given object / url are displayed.)\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp style=\"margin-bottom: 0in; font-weight: normal;\">Delete (All\n\tnotifications to a given object / url are ignored and currently\n\tsaved ones are deleted.  The sender is asked to discontinue sending\n\tnotifications.)\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp style=\"margin-bottom: 0in; font-weight: normal;\">SilentDelete\n\t(Same as delete except that the sender isn't asked to discontinue\n\tsending notifications.)\u003C/p>\n\u003C/li>\u003C/ul>\n\u003Col start=\"4\">\u003Cli>\u003Cp style=\"font-weight: normal;\">The client sends a POST request\n\tto the particle.updateObjectState endpoint with the following\n\turlencoded arguments:\u003C/p>\n\t\u003Col>\u003Cli>\u003Cp>\u003Cb>objectId\u003C/b>\u003C/p>\n\t\t\u003C/li>\u003Cli>\u003Cp>\u003Cb>objectState\u003C/b>\u003Cspan style=\"font-weight: normal;\">: \n\t\tEither \u201Cignore\u201D, \u201Cunignore\u201D, \u201Cdelete\u201D, or\n\t\t\u201CsilentDelete\u201D.\u003C/span>\u003C/p>\n\t\u003C/li>\u003C/ol>\n\t\u003C/li>\u003Cli>\u003Cp style=\"font-weight: normal;\">The server returns with 202\n\t(accepted) or a 4xx if an error occurs.  The 410 (Gone) state is\n\tused if the objectUrl is unknown.\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp style=\"font-weight: normal;\">All blocked requests for updates\n\tto notifications are completed.\u003C/p>\n\u003C/li>\u003C/ol>\n\u003Cp style=\"font-weight: normal;\">Some servers might allow\nsilently-deleted objects to become unignored; although this is\nimplementation-dependent.\u003C/p>\n\u003Ch1 class=\"western\" style=\"font-weight: normal;\">Blocking a user or\ndomain\u003C/h1>\n\u003Cp>The particle.block endpoint is used to block a user or domain.\u003C/p>\n\u003Col>\u003Cli>\u003Cp>A POST request is made to the particle.block endpoint with\n\tthe following urlencoded argument:\u003C/p>\n\t\u003Col>\u003Cli>\u003Cp>\u003Cb>toBlock\u003C/b>:  If this is a domain, then all senders from\n\t\tthe given domain are blocked.  If this is a complete OpenID url,\n\t\tthen the specific OpenID is blocked.\u003C/p>\n\t\u003C/li>\u003C/ol>\n\t\u003C/li>\u003Cli>\u003Cp>A 202 (Accepted) is returned if successful, else a 4xx code\n\tis returned to indicate an error.\u003C/p>\n\u003C/li>\u003C/ol>\n\u003Ch1 class=\"western\" style=\"font-weight: normal;\">Un-Blocking a user or\ndomain\u003C/h1>\n\u003Cp>The particle.unBlock endpoint is used to un-block a user or\ndomain.\u003C/p>\n\u003Col>\u003Cli value=\"1\">\u003Cp>A POST request is made to the particle.unBlock\n\tendpoint with the following urlencoded argument:\u003C/p>\n\t\u003Col>\u003Cli>\u003Cp>\u003Cb>toUnBlock\u003C/b>:  If this is a domain, then all senders\n\t\tfrom the given domain are un-blocked.  If this is a complete OpenID\n\t\turl, then the specific OpenID is un-blocked.\u003C/p>\n\t\u003C/li>\u003C/ol>\n\t\u003C/li>\u003Cli>\u003Cp>A 202 (Accepted) is returned if successful, else a 4xx code\n\tis returned to indicate an error.\u003C/p>\n\u003C/li>\u003C/ol>\n\u003Ch1 class=\"western\" style=\"font-weight: normal;\">Getting all blocked\nOpenIDs and domains\u003C/h1>\n\u003Cp style=\"font-weight: normal;\">The particle.getBlocked endpoint is\nused to return data about blocked users and domains.  All blocked\ndomains and endpoints are returned as a single Javascript array with\na 200 (OK) error code.\u003C/p>\n\u003Ch1 class=\"western\" style=\"font-weight: normal;\">Re-establish Trust\u003C/h1>\n\u003Cp style=\"font-weight: normal;\">TODO:  Perhaps\nparticle.reEstblishTrust endpoint with POST and urlencoded OpenID\nargument?\u003C/p>\n\u003Ch1 class=\"western\" style=\"font-weight: normal;\">Client Sending a\nNotification\u003C/h1>\n\u003Cp style=\"font-weight: normal;\">When a client sends a notification, it\nuses the particle.sendNotification endpoint to instruct its server to\nsend a notification.  This endpoint requires an active session\nbetween the client and the server.\u003C/p>\n\u003Col>\u003Cli value=\"1\">\u003Cp class=\"numbering-1-western\" style=\"font-weight: normal;\">\n\tThe client sends a POST request to the particle.sendNotification\n\tendpoint.  The following urlencoded arguments are present:\u003C/p>\n\t\u003Col>\u003Cli>\u003Cp class=\"numbering-1-western\">\u003Cb>openId\u003C/b>\u003Cspan style=\"font-weight: normal;\">:\n\t\t The openId of the notification's recipient.\u003C/span>\u003C/p>\n\t\t\u003C/li>\u003Cli>\u003Cp class=\"numbering-1-western\">\u003Cb>objectUrl\u003C/b>\u003Cspan style=\"font-weight: normal;\">:\n\t\t The URL to the document.  Displaying this URL in an iFrame should\n\t\talways work on simpler clients.  This value should never change,\n\t\tand is considered the object's unique ID.\u003C/span>\u003C/p>\n\t\t\u003C/li>\u003Cli>\u003Cp class=\"numbering-1-western\">\u003Cb>title\u003C/b>\u003Cspan style=\"font-weight: normal;\">:\n\t\t The title of the document.  This is always the newest version of\n\t\tthe target object's title, and can change between notifications.\u003C/span>\u003C/p>\n\t\t\u003C/li>\u003Cli>\u003Cp class=\"numbering-1-western\">\u003Cb>documentType\u003C/b>\u003Cspan style=\"font-weight: normal;\">:\n\t\t The document type.  Some particle clients might be able to provide\n\t\tenhanced capabilities for known document types.  For unknown\n\t\tdocument types, the url will be displayed in an iFrame.\u003C/span>\u003C/p>\n\t\t\u003C/li>\u003Cli>\u003Cp class=\"numbering-1-western\">\u003Cb>messageSummary\u003C/b>\u003Cspan style=\"font-weight: normal;\">:\n\t\t A summary of the notification that will be displayed to the\n\t\trecipient. Examples include:\u003C/span>\u003C/p>\n\t\u003C/li>\u003C/ol>\n\u003C/li>\u003C/ol>\n\u003Cul>\u003Cul>\u003Cul>\u003Cli>\u003Cp class=\"numbering-1-western\" style=\"font-weight: normal;\">Sender\n\t\t\tshared a document with you\u003C/p>\n\t\t\t\u003C/li>\u003Cli>\u003Cp class=\"numbering-1-western\" style=\"font-weight: normal;\">Sender\n\t\t\tupdated the document\u003C/p>\n\t\t\t\u003C/li>\u003Cli>\u003Cp class=\"numbering-1-western\" style=\"font-weight: normal;\">Sender\n\t\t\tadded you to the conversation\u003C/p>\n\t\t\t\u003C/li>\u003Cli>\u003Cp class=\"numbering-1-western\" style=\"font-weight: normal;\">Sender\n\t\t\tsaid: \u201C...\u201D\u003C/p>\n\t\t\u003C/li>\u003C/ul>\u003C/ul>\u003C/ul>\n\u003Col>\u003Col>\u003Cli>\u003Cp class=\"numbering-1-western\">\u003Cb>changeData\u003C/b>\u003Cspan style=\"font-weight: normal;\">:\n\t\t Additional data that describes the change.  This is only utilized\n\t\tif the client recognizes the documentType.  The specific format of\n\t\tchangeData is defined by the documentType.  JSON is recommended,\n\t\talthough any string-based encoding will work.\u003C/span>\u003C/p>\n\t\u003C/li>\u003C/ol>\u003Cli>\u003Cp class=\"numbering-1-western\" style=\"font-weight: normal;\">The\n\tfollowing optional arguments are supported:\u003C/p>\n\u003C/li>\u003C/ol>\n\u003Cul>\u003Cul>\u003Cli>\u003Cp>\u003Cb>forceRefreshSenderToken\u003C/b>\u003Cspan style=\"font-weight: normal;\">:\n\t\t Forces a refresh of the senderToken, defaults to false.\u003C/span>\u003C/p>\n\t\t\u003C/li>\u003Cli>\u003Cp>\u003Cb>forceRefreshEndpoints\u003C/b>\u003Cspan style=\"font-weight: normal;\">:\n\t\t Forces a refresh of the endpoints, defaults to false.\u003C/span>\u003C/p>\n\t\t\u003C/li>\u003Cli>\u003Cp>\u003Cb>maxRetries\u003C/b>\u003Cspan style=\"font-weight: normal;\">:\u003C/span>\u003C/p>\n\t\t\u003C/li>\u003Cli>\u003Cp>\u003Cb>transportErrorDelay\u003C/b>\u003Cspan style=\"font-weight: normal;\">:\n\t\t The amount of time to wait until retrying if there is some kind of\n\t\ta transport error.\u003C/span>\u003C/p>\n\t\u003C/li>\u003C/ul>\u003C/ul>\n\u003Col start=\"3\">\u003Cli>\u003Cp class=\"numbering-1-western\" style=\"font-weight: normal;\">A 202\n\t(Accepted) is returned if the notification can be sent, elsewise an\n\terror is returned.\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp class=\"numbering-1-western\" style=\"font-weight: normal;\">A 403\n\t(Forbidden) returned indicates that the recipient asked to no longer\n\treceive notifications regarding this object.\u003C/p>\n\t\u003C/li>\u003Cli>\u003Cp class=\"numbering-1-western\" style=\"font-weight: normal;\">Implementations\n\tmay choose to queue notifications and provide various retry\n\tcapabilities in the event of a failure.\u003C/p>\n\u003C/li>\u003C/ol>\n\u003Cp class=\"numbering-1-western\" style=\"margin-left: 0in; font-weight: normal;\">\nNotes:\u003C/p>\n\u003Cp class=\"numbering-1-western\" style=\"margin-left: 0in; font-weight: normal;\">\nNotifications are not guaranteed to be sent.  It is recommended that\nvarious clients and documentTypes utilize two-way notifications to\nverify success and notify the user of errors.  It is also recommended\nthat clients use some kind of visual indicator to show what kind of\ndata hasn't had a confirmation notification.\u003C/p>\n"}