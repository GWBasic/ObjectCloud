elevate(function()
{
   var version = base.GetVersion();

   // Constructor
   if (null == version)
      lockMe(function()
      {
         callAsOwner(function()
         {
            // Need to double-check in case someone else built the DB...
            version = base.GetVersion();
            if (null == version)
            {
               base.PostQuery("create table Post (pId integer not null primary key AUTOINCREMENT, text not null, timestamp integer not null, author not null)");

               base.SetVersion(0);
               version = 0;
            }
         });
      });
});


addReply.webCallable = "POST_application_x_www_form_urlencoded";
addReply.minimumWebPermission = "Write";
function addReply(replyText)
{
   elevate(function()
   {
      base.PostQuery(
         "insert into Post (text, timestamp, author) values (@text, @timestamp, @author)",
         {
            "@text": sanitize(replyText),
            "@author": userMetadata.name,
            "@timestamp": new Date().getTime()
         });
   });
}

readAllPosts.webCallable = "GET";
readAllPosts.minimumWebPermission = "Read";
function readAllPosts()
{
   var toReturn;

   elevate(function()
   {
      toReturn = base.PostQuery("select text, timestamp, author from Post order by timestamp desc")[0];
   });

   return toReturn;
}